@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@model Tixxp.WebApp.Models.ReservationManagement.ReservationListResultVm

<style>
    :root {
        --rm-accent: #FF7A00;
        --rm-border: rgba(0,0,0,.25);
    }

    .rm-grid-wrap {
        overflow: auto;
    }

    .rm-grid {
        border: 2px solid var(--rm-accent);
        border-radius: 10px;
        overflow: hidden; /* Köşeler birleşsin */
    }

        .rm-grid table {
            width: 100%;
            margin: 0;
            border-collapse: collapse; /* Kenarlar birleşsin */
        }

        .rm-grid thead th {
            position: sticky;
            top: 0;
            z-index: 2;
            background: #fff;
            border: 1px solid var(--rm-border) !important;
            border-bottom: 2px solid var(--rm-accent) !important;
            font-weight: 600;
        }

        .rm-grid tbody td {
            border: 1px solid var(--rm-border) !important;
        }

        .rm-grid tbody tr:hover td {
            background: rgba(255,122,0,.06);
        }

        .rm-grid .table {
            --bs-table-bg: #fff;
        }

        .rm-grid .badge {
            font-weight: 600;
        }

        .rm-grid .cell-nowrap {
            white-space: nowrap;
        }

        .rm-grid .money {
            font-variant-numeric: tabular-nums;
        }
</style>


<div class="card-body p-0">
    <div class="rm-grid-wrap">
        <div class="rm-grid">
            <table class="table mb-0 align-middle">
                <thead>
                <tr>
                    <th style="width: 110px;" class="cell-nowrap">@Localizer["_ReservationList.ID"]</th>
                    <th style="width: 160px;" class="cell-nowrap">@Localizer["_ReservationList.CREATED_DATE"]</th>
                    <th class="cell-nowrap">@Localizer["_ReservationList.Channel"]</th>
                    <th>@Localizer["_ReservationList.CUSTOMER"]</th>
                    <th class="cell-nowrap">@Localizer["_ReservationList.PAYMENT_TYPE"]</th>
                    <th class="cell-nowrap">@Localizer["_ReservationList.STATUS"]</th>
                    <th class="text-end cell-nowrap" style="width:120px;">@Localizer["_ReservationList.TOTAL"]</th>
                    <th class="text-center cell-nowrap" style="width:140px;">@Localizer["_ReservationList.ACTIONS"]</th>

                </tr>
                </thead>
                <tbody>
                    @if (Model.Items != null && Model.Items.Any())
                    {
                        foreach (var r in Model.Items)
                        {
                            var badgeClass = r.StatusId switch
                            {
                                1 => "status-pending",
                                2 => "status-completed",
                                3 => "status-cancelled",
                                _ => "bg-secondary"
                            };

                            <tr class="row-hover">
                                <td class="fw-semibold cell-nowrap">#@r.Id</td>
                                <td class="cell-nowrap">@r.CreatedDate.ToString("dd.MM.yyyy HH:mm")</td>
                                <td>@r.ChannelName</td>
                                <td>
                                    <div class="fw-semibold text-truncate" style="max-width:200px;" title="@r.FullName">@r.FullName</div>
                                    <div class="small text-muted text-truncate" style="max-width:200px;" title="@r.Email">@r.Email</div>
                                </td>
                                <td class="cell-nowrap">@r.PaymentTypeName</td>
                                <td class="cell-nowrap"><span class="badge @badgeClass">@r.StatusName</span></td>
                                <td class="text-end money cell-nowrap">
                                    @r.TotalPrice.ToString("N2") @r.CurrencySymbol
                                </td>
                                <td class="text-center">
                                    <div class="d-inline-flex gap-1">
                                        <button type="button" class="btn btn-sm btn-outline-secondary js-detail"
                                                data-id="@r.Id" data-bs-toggle="tooltip"
                                                title="@Localizer["_ReservationList.DETAIL"]">
                                            <i class="ti ti-list-details"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-dark js-resend"
                                                data-id="@r.Id" data-bs-toggle="tooltip"
                                                title="@Localizer["_ReservationList.RESEND_EMAIL"]">
                                            <i class="ti ti-mail-forward"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-primary js-change-pay"
                                                data-id="@r.Id" data-bs-toggle="tooltip"
                                                title="@Localizer["_ReservationList.CHANGE_PAYMENT"]">
                                            <i class="ti ti-tax-euro"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger js-cancel"
                                                data-id="@r.Id" data-bs-toggle="tooltip"
                                                title="@Localizer["_ReservationList.CANCEL"]">
                                            <i class="ti ti-x"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="8" class="text-center text-muted py-4">
                                @Localizer["_ReservationList.NO_RECORDS_FOUND"]
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    @{
        var totalPages = (int)Math.Ceiling((Model.TotalCount * 1.0) / Math.Max(1, Model.PageSize));
        if (totalPages < 1) totalPages = 1;
        var win = 9;
        var start = Math.Max(1, Model.Page - win / 2);
        var end = Math.Min(totalPages, start + win - 1);
        if (end - start + 1 < win) start = Math.Max(1, end - win + 1);
    }
    <div class="d-flex justify-content-between align-items-center p-3">
        <div class="small text-muted">
            @Localizer["_ReservationList.PAGE"] @Model.Page / @totalPages •
            @Localizer["_ReservationList.TOTAL"] @Model.TotalCount
        </div>
        <nav>
            <ul class="pagination pagination-sm mb-0">
                <li class="page-item @(Model.Page <= 1 ? "disabled" : "")">
                    <a class="page-link js-page" href="#" data-page="@(Model.Page - 1)">
                        @Localizer["_ReservationList.PREV"]
                    </a>
                </li>
                @if (start > 1)
                {
                    <li class="page-item"><a class="page-link js-page" href="#" data-page="1">1</a></li>
                    @if (start > 2)
                    {
                        <li class="page-item disabled"><span class="page-link">…</span></li>
                    }
                }
                @for (var i = start; i <= end; i++)
                {
                    <li class="page-item @(i == Model.Page ? "active" : "")">
                        <a class="page-link js-page" href="#" data-page="@i">@i</a>
                    </li>
                }
                @if (end < totalPages)
                {
                    @if (end < totalPages - 1)
                    {
                        <li class="page-item disabled"><span class="page-link">…</span></li>
                    }
                    <li class="page-item"><a class="page-link js-page" href="#" data-page="@totalPages">@totalPages</a></li>
                }
                <li class="page-item @(Model.Page >= totalPages ? "disabled" : "")">
                    <a class="page-link js-page" href="#" data-page="@(Model.Page + 1)">
                        @Localizer["_ReservationList.NEXT"]
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>
