@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@model Tixxp.WebApp.Models.ReservationManagement.ReservationDetailVm

@{
    var fullName = string.Join(" ",
        new[] { Model?.InvoiceInfo?.Name, Model?.InvoiceInfo?.Surname }
            .Where(s => !string.IsNullOrWhiteSpace(s)));
    if (string.IsNullOrWhiteSpace(fullName)) fullName = "-";

    var paymentTypeText =
        !string.IsNullOrWhiteSpace(Model?.InvoiceInfo?.PaymentTypeName)
            ? Model.InvoiceInfo.PaymentTypeName
            : (Model?.InvoiceInfo?.PaymentTypeId != null
                ? $"#{Model.InvoiceInfo.PaymentTypeId}"
                : "-");
}

<style>
    .summary-card {
        border: 1px solid #e5e5e5;
        transition: all 0.3s ease;
        cursor: pointer;
        background-color: #fff;
    }

        .summary-card:hover {
            background-color: #FFF3E6;
            border-color: #FF7A00 !important;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(255, 122, 0, 0.3);
        }
</style>

<div class="container-fluid">
    <div class="row g-3">

        <!-- Reservation summary -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100 summary-card">
                <div class="card-header fw-semibold">@Localizer["_ReservationDetail.RESERVATION"]</div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-5">@Localizer["_ReservationDetail.RESERVATION_ID"]</dt>
                        <dd class="col-7">#@Model.ReservationId</dd>

                        <dt class="col-5">@Localizer["_ReservationDetail.CREATED_DATE"]</dt>
                        <dd class="col-7">@Model.CreatedDate.ToString("yyyy-MM-dd HH:mm")</dd>

                        <dt class="col-5">@Localizer["_ReservationDetail.STATUS"]</dt>
                        <dd class="col-7">@Model.StatusName</dd>

                        <dt class="col-5">@Localizer["_ReservationDetail.CHANNEL"]</dt>
                        <dd class="col-7">@(!string.IsNullOrWhiteSpace(Model.ChannelName) ? Model.ChannelName : $"#{Model.ChannelId}")</dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Invoice / Customer -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100 summary-card">
                <div class="card-header fw-semibold">@Localizer["_ReservationDetail.INVOICE_CUSTOMER"]</div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-5">@Localizer["_ReservationDetail.NAME"]</dt>
                        <dd class="col-7">@fullName</dd>

                        <dt class="col-5">@Localizer["_ReservationDetail.EMAIL"]</dt>
                        <dd class="col-7">@(!string.IsNullOrWhiteSpace(Model?.InvoiceInfo?.Email) ? Model.InvoiceInfo.Email : "-")</dd>

                        <dt class="col-5">@Localizer["_ReservationDetail.PHONE"]</dt>
                        <dd class="col-7">@(!string.IsNullOrWhiteSpace(Model?.InvoiceInfo?.Phone) ? Model.InvoiceInfo.Phone : "-")</dd>

                        <dt class="col-5">@Localizer["_ReservationDetail.PAYMENT_TYPE"]</dt>
                        <dd class="col-7">@paymentTypeText</dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Tickets -->
        <div class="col-12">
            <div class="card border-0 shadow-sm summary-card">
                <div class="card-header fw-semibold">@Localizer["_ReservationDetail.TICKETS"]</div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 240px;">@Localizer["_ReservationDetail.TICKET_TYPE"]</th>
                                    <th style="width: 240px;">@Localizer["_ReservationDetail.SUB_TYPE"]</th>
                                    <th style="width: 120px;">@Localizer["_ReservationDetail.PIECE"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.Tickets != null && Model.Tickets.Any())
                                {
                                    foreach (var t in Model.Tickets)
                                    {
                                        <tr>
                                            <td>@(string.IsNullOrWhiteSpace(t.TicketTypeName) ? $"#{t.TicketTypeId}" : t.TicketTypeName)</td>
                                            <td>
                                                @(string.IsNullOrWhiteSpace(t.TicketSubTypeName)
                                                                                        ? (t.TicketSubTypeId > 0 ? $"#{t.TicketSubTypeId}" : "-")
                                                                                        : t.TicketSubTypeName)
                                    </td>
                                    <td>@t.Piece</td>
                                </tr>
                                                                }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="3" class="text-center text-muted py-3">
                                            @Localizer["_ReservationDetail.TICKET_NOT_FOUND"]
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products -->
        <div class="col-12">
            <div class="card border-0 shadow-sm summary-card">
                <div class="card-header fw-semibold">@Localizer["_ReservationDetail.PRODUCTS"]</div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>@Localizer["_ReservationDetail.PRODUCT_NAME"]</th>
                                    <th style="width: 120px;">@Localizer["_ReservationDetail.PIECE"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.Products != null && Model.Products.Any())
                                {
                                    foreach (var p in Model.Products)
                                    {
                                        <tr>
                                            <td>@(string.IsNullOrWhiteSpace(p.ProductName) ? $"#{p.ProductId}" : p.ProductName)</td>
                                            <td>@p.Piece</td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="2" class="text-center text-muted py-3">
                                            @Localizer["_ReservationDetail.PRODUCT_NOT_FOUND"]
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Özet Kartlar -->
        <div class="col-12 mt-3">
            <div class="row g-3">

                <!-- Total Tickets -->
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm text-center h-100 summary-card">
                        <div class="card-body">
                            <div class="fw-bold text-muted">🎟️ @Localizer["_ReservationDetail.TOTAL_TICKETS"]</div>
                            <div class="fs-4 fw-semibold text-dark">
                                @(Model.Tickets?.Sum(t => t.Piece) ?? 0)
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Products -->
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm text-center h-100 summary-card">
                        <div class="card-body">
                            <div class="fw-bold text-muted">📦 @Localizer["_ReservationDetail.TOTAL_PRODUCTS"]</div>
                            <div class="fs-4 fw-semibold text-dark">
                                @(Model.Products?.Sum(p => p.Piece) ?? 0)
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Items -->
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm text-center h-100 summary-card">
                        <div class="card-body">
                            <div class="fw-bold text-muted">🧾 @Localizer["_ReservationDetail.TOTAL_ITEMS"]</div>
                            <div class="fs-4 fw-semibold text-dark">
                                @((Model.Tickets?.Sum(t => t.Piece) ?? 0) + (Model.Products?.Sum(p => p.Piece) ?? 0))
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Amount -->
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm text-center h-100 summary-card">
                        <div class="card-body">
                            <div class="fw-bold text-muted">💰 @Localizer["_ReservationDetail.TOTAL_AMOUNT"]</div>
                            <div class="fs-4 fw-bold text-dark">
                                @Model.TotalPrice.ToString("N2") @Model.CurrencySymbol
                                @* Örn: 1.234,00 ₺ veya 200.00 $ *@
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>
