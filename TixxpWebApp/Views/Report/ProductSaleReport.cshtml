@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Ürün Satış Raporu";

    var chartDataJson = Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.ProductSaleChartData ?? new List<object>());
}

<div class="page">
    <div class="main-content app-content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-xl-10 mx-auto">
                    <div class="card custom-card mt-4">
                        <div class="card-header">
                            <div class="card-title">Ürün Satış Raporu</div>
                        </div>
                        <div class="card-body">
                            <div id="productsalereport" style="height: 400px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
    var data = @Html.Raw(chartDataJson);

    document.addEventListener("DOMContentLoaded", function () {
        const categories = [...new Set(data.map(d => d.Date))];
        const products = [...new Set(data.map(d => d.ProductName))];

        const series = products.map(product => ({
            name: product,
            data: categories.map(date => {
                const match = data.find(d => d.ProductName === product && d.Date === date);
                return match ? match.Quantity : 0;
            })
        }));

        const options = {
            series: series,
            chart: {
                type: 'bar',
                height: 400,
                stacked: true,
                stackType: '100%',
                toolbar: {
                    show: true,
                    tools: {
                        download: true,
                        zoom: true,
                        pan: false,
                        reset: true
                    }
                },
                zoom: {
                    enabled: true
                }
            },
            grid: {
                borderColor: '#f2f5f7'
            },
            colors: ['#ff0000', '#000000', '#8c9097', '#5b67c7', '#f5b849', '#23b7e5'],
            xaxis: {
                categories: categories,
                labels: {
                    style: {
                        colors: "#8c9097",
                        fontSize: '11px',
                        fontWeight: 600
                    }
                }
            },
            yaxis: {
                labels: {
                    style: {
                        colors: "#8c9097",
                        fontSize: '11px',
                        fontWeight: 600
                    }
                }
            },
            fill: {
                opacity: 1
            },
            legend: {
                position: 'right',
                offsetY: 10,
                markers: {
                    width: 12,
                    height: 12,
                    radius: 12
                },
                labels: {
                    colors: '#000'
                }
            },
            dataLabels: {
                enabled: true
            }
        };

        const chart = new ApexCharts(document.querySelector("#productsalereport"), options);
        chart.render();
    });
</script>
